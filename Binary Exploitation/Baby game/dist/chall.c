#include <stdio.h>
#include <stdlib.h>

unsigned long long balance = 0;

char ITEMS[][10] = {
    "Books",
    "Tickey",
    "Flag"
};
int PRICES[] = {
    100000,
    50000,
    100000000
};

int inventory[] = {
    0,
    0,
    0
};

void buy(int item, int amount) {
    if ((int)balance < PRICES[item] * amount) {
        puts("Not enough balance");
        return;
    }
    balance -= PRICES[item] * amount;
    printf("You bought %d %s\n", amount, ITEMS[item]);
    inventory[item] += amount;
}

void sell(int item, int amount) {
    if (inventory[item] < amount) {
        puts("Not enough item");
        return;
    }
    balance += PRICES[item] * amount;
    printf("You sold %d %s\n", amount, ITEMS[item]);
    inventory[item] -= amount;
}

void getFlag() {
    if (inventory[2] < 1) {
        puts("You don't have the flag");
        return;
    }

    FILE *file = fopen("flag.txt", "r");
    if (file == NULL) {
        puts("Cannot open flag.txt");
        exit(1);
    }

    char flag[100];
    fgets(flag, 100, file);

    printf("Flag: %s\n", flag);
    fclose(file);

    exit(0);
}

int main() {
    setvbuf(stdin, 0, 2, 0);
    setvbuf(stdout, 0, 2, 0);
    setvbuf(stderr, 0, 2, 0);

    while (1) {
        puts("Welcome to the shop");
        printf("Balance: %llu\n", balance);
        puts("1. Buy");
        puts("2. Sell");
        puts("3. Get flag");
        puts("4. Exit");

        int choice;
        int item;
        int amount;
        printf("Choice: ");
        scanf("%d", &choice);

        switch (choice) {
            case 1:
                puts("1. Books (100000)");
                puts("2. Ticket (50000)");
                puts("3. Flag (1000000000)");
                printf("Item: ");
                scanf("%d", &item);
                printf("Amount: ");
                scanf("%d", &amount);
                buy(item - 1, amount);
                break;
            case 2:
                puts("1. Books (100000)");
                puts("2. Ticket (50000)");
                puts("3. Flag (1000000000)");
                printf("Item: ");
                scanf("%d", &item);
                printf("Amount: ");
                scanf("%d", &amount);
                sell(item - 1, amount);
                break;
            case 3:
                getFlag();
                break;
            case 4:
                exit(0);
                break;
            default:
                puts("Invalid choice");
                break;
        }
    }
}